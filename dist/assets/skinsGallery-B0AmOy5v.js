const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DS1SNXS7.js","assets/index-DFveuqp5.css","assets/shop-DiCi7msN.js","assets/zeus-C7msOkHA.js"])))=>i.map(i=>d[i]);
var w=Object.defineProperty;var C=(l,i,o)=>i in l?w(l,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[i]=o;var h=(l,i,o)=>C(l,typeof i!="symbol"?i+"":i,o);import{L as M,F as S,m as k,_ as f}from"./index-DS1SNXS7.js";import{_ as E,a as O,b as P,c as I,d as R,e as A,f as j,g as z,h as F,i as T,j as W}from"./zeus-C7msOkHA.js";class D{constructor(i){h(this,"root");h(this,"bgCanvas");h(this,"bgCtx");h(this,"level");h(this,"pellets",[]);h(this,"grid");h(this,"bgRAF");h(this,"bgActive",!1);this.opts=i,this.root=document.createElement("div"),Object.assign(this.root.style,{position:"fixed",inset:"0",zIndex:"120",display:"grid",gridTemplateRows:"auto 1fr",background:"transparent"}),this.bgCanvas=document.createElement("canvas"),Object.assign(this.bgCanvas.style,{position:"absolute",inset:"0",width:"100%",height:"100%"});const o=this.bgCanvas.getContext("2d");if(!o)throw new Error("no 2d");this.bgCtx=o,this.level=new M(this.bgCanvas),this.resizeBg(),this.initPellets(),window.addEventListener("resize",()=>{this.resizeBg(),this.initPellets()});const s=document.createElement("div");Object.assign(s.style,{position:"relative",zIndex:"1",display:"flex",alignItems:"center",gap:"10px",padding:"12px 16px",margin:"14px auto 8px",width:"min(980px, 94vw)",borderRadius:"14px",background:"rgba(8,10,28,0.72)",backdropFilter:"blur(10px)",color:"#fff",boxShadow:"0 12px 28px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,0.06)"});const c=document.createElement("button");c.textContent="← Zurück",Object.assign(c.style,{padding:"10px 12px",border:"0",borderRadius:"10px",cursor:"pointer",fontWeight:"900",background:"rgba(255,255,255,0.14)",color:"#fff"}),c.onclick=()=>this.close();const r=document.createElement("div");r.textContent="Skins",Object.assign(r.style,{fontSize:"20px",fontWeight:"900",letterSpacing:"1px"}),s.append(c,r);const e=document.createElement("div");Object.assign(e.style,{position:"relative",zIndex:"1",margin:"0 auto 18px",padding:"16px",width:"min(980px, 94vw)",borderRadius:"16px",background:"rgba(8,10,28,0.72)",backdropFilter:"blur(10px)",color:"#fff",boxShadow:"0 24px 48px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,0.06)"});const n=document.createElement("div");Object.assign(n.style,{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(92px, 1fr))",gap:"12px",alignItems:"center"}),this.grid=n,e.appendChild(this.grid),this.root.append(this.bgCanvas,s,e),document.body.appendChild(this.root),this.populateGrid(),this.loopBg()}initPellets(){const i=this.bgCanvas.width,o=this.bgCanvas.height,s=Math.floor(Math.min(1e3,Math.max(280,i*o/7e3)));this.pellets=[];for(let c=0;c<s;c++){const r=Math.random()*1.4+.6,e=Math.random()*Math.PI*2,n=(Math.random()*10+4)*.4;this.pellets.push({x:Math.random()*i,y:Math.random()*o,r,vx:Math.cos(e)*n,vy:Math.sin(e)*n,alpha:.6+Math.random()*.3,tw:(Math.random()*2-1)*.4})}}resizeBg(){const i=Math.max(1,Math.min(window.devicePixelRatio||1,2)),o=Math.floor(window.innerWidth*i),s=Math.floor(window.innerHeight*i);this.bgCanvas.width=o,this.bgCanvas.height=s,this.bgCanvas.style.width="100%",this.bgCanvas.style.height="100%",this.bgCtx.setTransform(1,0,0,1,0,0)}loopBg(){const i=this.bgCtx;let o=performance.now();if(this.bgActive)return;this.bgActive=!0;const s=c=>{if(!this.bgActive)return;const r=(c-o)/1e3;o=c,i.setTransform(1,0,0,1,0,0);const e=this.bgCanvas.width,n=this.bgCanvas.height;this.level.drawBackgroundScreen(i),i.save();for(const t of this.pellets){t.x+=t.vx*r,t.y+=t.vy*r,t.x<-4?t.x=e+4:t.x>e+4&&(t.x=-4),t.y<-4?t.y=n+4:t.y>n+4&&(t.y=-4);const a=Math.max(.2,Math.min(1,t.alpha+Math.sin(c*.001+t.x*.01+t.y*.01)*.08));i.beginPath(),i.arc(t.x,t.y,Math.max(2,t.r*1),0,Math.PI*2),i.fillStyle=`rgba(255,255,255,${.82*a})`,i.fill()}i.restore(),this.bgRAF=requestAnimationFrame(s)};this.bgRAF=requestAnimationFrame(s)}addThumb(i,o,s){const c=document.createElement("button");Object.assign(c.style,{border:"0",padding:"0",background:"transparent",cursor:"pointer",position:"relative"});const r=92,e=40,n=document.createElement("canvas");n.width=r,n.height=r,n.style.display="block";const t=n.getContext("2d");if(t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",t.clearRect(0,0,r,r),t.save(),t.beginPath(),t.arc(r/2,r/2,e,0,Math.PI*2),t.clip(),t.drawImage(o,r/2-e,r/2-e,e*2,e*2),t.restore(),t.lineWidth=2,t.strokeStyle="rgba(255,255,255,0.28)",t.beginPath(),t.arc(r/2,r/2,e,0,Math.PI*2),t.stroke(),s!=null&&s.isShop){const d=document.createElement("span");d.textContent=s.badge||"SHOP",Object.assign(d.style,{position:"absolute",left:"6px",top:"6px",padding:"2px 6px",borderRadius:"8px",fontSize:"10px",fontWeight:"900",background:"rgba(52,211,153,0.95)",color:"#052",boxShadow:"0 2px 6px rgba(0,0,0,.25)"}),c.appendChild(d)}const a=document.createElement("div");a.textContent=i,Object.assign(a.style,{marginTop:"6px",fontSize:"12px",color:"#dfe6ff",textAlign:"center",opacity:"0.9"}),c.append(n,a),c.onclick=(s==null?void 0:s.onClick)??(()=>{this.opts.onPick(o),this.close()}),this.grid.appendChild(c)}async populateGrid(){S.forEach((e,n)=>{const t=k(e);this.addThumb(typeof e=="string"?e:`Preset ${n+1}`,t,void 0)});const o={};try{const e=Object.assign({"../premium/1.png":W,"../premium/3.png":T,"../premium/4.png":F,"../premium/5.png":z,"../premium/dergott.png":j,"../premium/enkhi.png":A,"../premium/gaia.png":R,"../premium/galaxy.png":I,"../premium/goettin.png":P,"../premium/mihi.png":O,"../premium/zeus.png":E});for(const[n,t]of Object.entries(e)){const a=(n.split("/").pop()||"").split(".")[0];o[a]=t}}catch{}let s={};try{const{auth:e}=await f(async()=>{const{auth:t}=await import("./index-DS1SNXS7.js").then(a=>a.c);return{auth:t}},__vite__mapDeps([0,1])),n=e.currentUser;if(n!=null&&n.uid){const{fetchUserSkins:t}=await f(async()=>{const{fetchUserSkins:a}=await import("./index-DS1SNXS7.js").then(d=>d.r);return{fetchUserSkins:a}},__vite__mapDeps([0,1]));s=await t(n.uid)||{}}}catch{}const c=Object.keys(s).filter(e=>s[e]);if(c.length){const e=document.createElement("div");e.textContent="Meine Skins",Object.assign(e.style,{gridColumn:"1 / -1",color:"#aee",fontSize:"12px",opacity:"0.9",margin:"12px 0 0"}),this.grid.appendChild(e);for(const n of c){const t=o[n];if(!t)continue;const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{const d=document.createElement("canvas");d.width=220,d.height=220;const g=d.getContext("2d");g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high";const p=a.naturalWidth||a.width,m=a.naturalHeight||a.height,b=Math.max(220/p,220/m),u=Math.round(p*b),x=Math.round(m*b),_=Math.round((220-u)/2),v=Math.round((220-x)/2);g.clearRect(0,0,220,220),g.drawImage(a,_,v,u,x),this.addThumb(n,d,void 0)},a.src=t}}const r=document.createElement("div");r.textContent="Shop Skins",Object.assign(r.style,{gridColumn:"1 / -1",color:"#aee",fontSize:"12px",opacity:"0.9",margin:"12px 0 0"}),this.grid.appendChild(r);for(const[e,n]of Object.entries(o)){const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const a=document.createElement("canvas");a.width=220,a.height=220;const d=a.getContext("2d");d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high";const g=t.naturalWidth||t.width,p=t.naturalHeight||t.height,m=Math.max(220/g,220/p),b=Math.round(g*m),u=Math.round(p*m),x=Math.round((220-b)/2),_=Math.round((220-u)/2);d.clearRect(0,0,220,220),d.drawImage(t,x,_,b,u);const v=!!s[e];this.addThumb(e,a,{isShop:!0,onClick:v?()=>{this.opts.onPick(a),this.close()}:()=>{f(()=>import("./shop-DiCi7msN.js"),__vite__mapDeps([2,3,0,1])).then(y=>new y.ShopOverlay)}})},t.src=n}}show(){this.root.style.display="grid"}close(){var i,o;this.bgRAF!==void 0&&(cancelAnimationFrame(this.bgRAF),this.bgRAF=void 0),this.bgActive=!1,this.root.remove(),(o=(i=this.opts).onClose)==null||o.call(i)}}export{D as SkinsGallery};
